# Photo Watermarker

## 项目简介
这是一个基于 Python 和 PyQt5 的本地图片水印工具，支持批量导入图片、调整图片格式、添加前缀/后缀命名规则，自定义水印样式，并导出为 JPEG 或 PNG 格式。

## 项目功能

### **文件处理**

#### 1.1导入图片

支持单张图片拖拽或通过文件选择器导入。

支持批量导入，可一次性选择多张图片或直接导入整个文件夹。

在界面上显示已导入图片的列表（缩略图和文件名）。

#### 1.2支持格式

输入格式：主流格式如 JPEG, PNG。支持 BMP, TIFF。PNG格式支持透明通道。

输出格式：用户可选择输出为 JPEG 或 PNG。

#### 1.3导出图片

用户可指定一个输出文件夹。为防止覆盖原图，默认禁止导出到原文件夹。

提供导出文件命名规则选项：

​	保留原文件名。

​	添加自定义前缀（如 wm_）。

​	添加自定义后缀（如 _watermarked）。

对于 JPEG 格式，提供图片质量（压缩率）调节滑块（0-100）。（可选高级功能）（**已实现**）

导出时允许用户调整图片尺寸（如按宽度、高度或百分比缩放）。（可选高级功能）（**已实现**）



### **水印类型**

#### 2.1文本水印

内容：用户可自定义输入任意文本。

字体：可选择系统已安装的字体、字号、粗体、斜体。（可选高级功能）（**实现为选择项目Fonts文件夹内的字体，其中Calibri字体可支持粗体、斜体**）

颜色：提供调色板让用户选择字体颜色。（可选高级功能）（**已实现**）

透明度：可调节文本的透明度（0-100%）。

样式：可添加阴影或描边效果，以增强在复杂背景下的可读性。（可选高级功能）（**已实现**）

#### 2.2图片水印（可选高级功能）

用户可从本地选择一张图片（如Logo）作为水印。

必须支持带透明通道的 PNG 图片。

缩放：可按比例或自由调整图片水印的大小。（**实现为按比例缩放或按指定高度缩放或按指定宽度缩放**）

透明度：可调节图片水印的整体透明度（0-100%）。



### 水印布局与样式

#### 3.1实时预览：

所有对水印的调整都应在主预览窗口中实时显示效果。用户可以点击图片列表切换预览不同的图片。

#### 3.2位置

​	预设位置：提供九宫格布局（四角、正中心），用户可一键将水印放置在这些位置。

​	手动拖拽：用户可以直接在预览图上通过鼠标拖拽水印到任意位置。

#### 3.3旋转：

提供一个滑块或输入框，允许用户以任意角度旋转水印。（可选高级功能）（**未成功实现**）



### 配置管理

#### 4.1 水印模板：

用户可以将当前的水印设置（包括水印内容、字体、颜色、位置、大小、透明度等所有参数）保存为一个模板。

用户可以加载、管理和删除已保存的模板。

程序启动时可自动加载上一次关闭时的设置或一个默认模板。（**实现为加载默认模板，内容为'Add Watermark',设置在图片右下角**）


## 环境依赖
- Python 3.6 或更高版本
- PyQt5
- Pillow

## 安装依赖
在终端或命令提示符中运行以下命令安装依赖：
```bash
pip install PyQt5 Pillow
```

## 运行程序
1. 请确保项目的文件结构如下：
   ```
   f:\研究生阶段\研一上\AI4SE-photowatermarker2\
   ├── fonts           # 字体资源文件夹，存放水印所需的字体文件
   ├── main.py         # 项目入口文件
   ├── ui_main.py      # 用户界面逻辑文件
   ├── image_processor.py # 图片处理逻辑文件
   ├── README.md       # 项目说明文档
   ├── templates.json  # 默认水印模板配置文件
   ```
2. 运行以下命令启动程序：
   ```bash
   python main.py
   ```

## 打包为可执行文件
使用 PyInstaller 将程序打包为 Windows 可执行文件，并确保 `fonts` 文件夹被正确包含：
```bash
pip install pyinstaller
pyinstaller --onefile --noconsole --add-data "fonts;fonts" --add-data "templates.json;." main.py
```

### 参数说明
- `--add-data "fonts;fonts"`：将 `fonts` 文件夹添加到打包的可执行文件中。第一个 `fonts` 是源路径，第二个 `fonts` 是目标路径。
- `--noconsole`：隐藏控制台窗口。

## 注意事项
- 水印字号以像素为单位，故而有时候同一个模板在不同图片上显示效果差别较大。请根据图片实际大小设置。
- 如果需要忽略某些文件夹，请在 `.gitignore` 文件中添加相应规则。
- 如果遇到网络问题导致无法推送到 GitHub，请检查代理设置或使用 SSH 连接。

